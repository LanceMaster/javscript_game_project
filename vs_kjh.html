<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VS_ê¹€ì¤€í¬</title>
    <style>
        /* ê¸°ë³¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ì„¤ì • */
        body {
            margin: 0;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ìˆ¨ê¸°ê¸° */
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #0a0a2e, #16213e); /* ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
        }

        /* ê²Œì„ ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
        canvas {
            display: block;
            background: radial-gradient(circle at center, #1a1a40 0%, #000 100%); /* ì›í˜• ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
        }

        /* ê²Œì„ ì •ë³´ í‘œì‹œ (ì ìˆ˜, ë ˆë²¨, ì²´ë ¥) */
        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff88;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff88; /* ê¸€ë¡œìš° íš¨ê³¼ */
            z-index: 10;
        }

        /* íƒ€ì´ë¨¸ í‘œì‹œ */
        .timer {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #ff4444;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 15px #ff4444; /* ê¸€ë¡œìš° íš¨ê³¼ */
            z-index: 10;
        }

        /* ê²Œì„ ì‹œì‘ í™”ë©´ */
        .start-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* ì¤‘ì•™ ì •ë ¬ */
            text-align: center;
            color: white;
            z-index: 100;
        }

        /* ì‹œì‘ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .start-button {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(45deg, #ff4444, #ff8844);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
            transition: all 0.3s ease; /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
        }

        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .start-button:hover {
            transform: scale(1.05); /* ì•½ê°„ í™•ëŒ€ */
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.6); /* ê·¸ë¦¼ì ê°•í™” */
        }

        /* ê²Œì„ ì œëª© ìŠ¤íƒ€ì¼ */
        .title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 0 0 20px #00ff88;
            background: linear-gradient(45deg, #00ff88, #44ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; /* ê·¸ë¼ë°ì´ì…˜ í…ìŠ¤íŠ¸ */
        }

        /* ê²Œì„ ì„¤ëª… í…ìŠ¤íŠ¸ */
        .instructions {
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.5;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- ê²Œì„ì´ ê·¸ë ¤ì§ˆ ìº”ë²„ìŠ¤ -->
    <canvas id="gameCanvas"></canvas>

    <!-- ê²Œì„ ìƒíƒœ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
    <div class="hud">
        <div>ì ìˆ˜: <span id="score">0</span></div>
        <div>ë ˆë²¨: <span id="level">1</span></div>
        <div>ì²´ë ¥: <span id="health">ğŸ’–ğŸ’–ğŸ’–</span></div>
    </div>

    <!-- ë‚¨ì€ ì‹œê°„ í‘œì‹œ -->
    <div class="timer" id="timer">60</div>

    <!-- ê²Œì„ ì‹œì‘ í™”ë©´ -->
    <div class="start-screen" id="startScreen">
        <div class="title">êµ¬ë””90_ê¹€ì¤€í¬</div>
        <br>
        <div class="title">ë±€íŒŒì´ì–´ ì„œë°”ì´ë²Œ ëª¨ì‘</div>
        <div class="instructions">
            â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸ ì´ë™ | ìŠ¤í˜ì´ìŠ¤ë°” ìŠ¤í‚¬ | ìë™ ê³µê²©<br>
            ë¹¨ê°„ ì : ì¼ë°˜ | íŒŒë€ ì : ë¹ ë¦„ | ë³´ë¼ ì : ê°•í•¨<br>
            ğŸ’ ì ìˆ˜ ì¦ê°€ | âš¡ íŒŒì›Œì—… | ğŸ’– ì²´ë ¥ íšŒë³µ
        </div>
        <button class="start-button" id="startButton">ê²Œì„ ì‹œì‘</button>
    </div>

    <script>
        // ===== ê¸°ë³¸ ì„¤ì • ë° ì´ˆê¸°í™” =====
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d"); // 2D ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸

        // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë¸Œë¼ìš°ì € ì°½ í¬ê¸°ì— ë§ì¶¤
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // ===== ê²Œì„ ìƒíƒœ ê´€ë¦¬ ê°ì²´ =====
        let gameState = {
            score: 0,           // í˜„ì¬ ì ìˆ˜
            level: 1,           // í˜„ì¬ ë ˆë²¨
            health: 3,          // í˜„ì¬ ì²´ë ¥
            maxHealth: 3,       // ìµœëŒ€ ì²´ë ¥
            timeLeft: 60,       // ë‚¨ì€ ì‹œê°„ (ì´ˆ)
            isPoweredUp: false, // íŒŒì›Œì—… ìƒíƒœ ì—¬ë¶€
            powerUpTimer: 0,    // íŒŒì›Œì—… ë‚¨ì€ ì‹œê°„
            backgroundOffset: 0 // ë°°ê²½ ìŠ¤í¬ë¡¤ ì˜¤í”„ì…‹
        };

        // ===== HTML ìš”ì†Œ ì°¸ì¡° =====
        const scoreElement = document.getElementById("score");
        const levelElement = document.getElementById("level");
        const healthElement = document.getElementById("health");
        const timerElement = document.getElementById("timer");
        const startScreen = document.getElementById("startScreen");
        const startButton = document.getElementById("startButton");

        // ===== í”Œë ˆì´ì–´ ê°ì²´ =====
        const player = {
            x: canvas.width / 2,    // X ì¢Œí‘œ (í™”ë©´ ì¤‘ì•™)
            y: canvas.height / 2,   // Y ì¢Œí‘œ (í™”ë©´ ì¤‘ì•™)
            size: 30,               // í”Œë ˆì´ì–´ í¬ê¸°
            color: "#00ff88",       // í”Œë ˆì´ì–´ ìƒ‰ìƒ (ì´ˆë¡)
            speed: 6,               // ì´ë™ ì†ë„
            trail: []               // ì´ë™ ê¶¤ì  íš¨ê³¼ë¥¼ ìœ„í•œ ë°°ì—´
        };

        // ===== ê²Œì„ ì˜¤ë¸Œì íŠ¸ ë°°ì—´ë“¤ =====
        const keys = {};        // í˜„ì¬ ëˆŒë¦° í‚¤ë“¤ì„ ì €ì¥
        const enemies = [];     // ì ë“¤ì„ ì €ì¥í•˜ëŠ” ë°°ì—´
        const bullets = [];     // ì´ì•Œë“¤ì„ ì €ì¥í•˜ëŠ” ë°°ì—´
        const particles = [];   // íŒŒí‹°í´ íš¨ê³¼ë“¤ì„ ì €ì¥í•˜ëŠ” ë°°ì—´
        const powerUps = [];    // íŒŒì›Œì—… ì•„ì´í…œë“¤ì„ ì €ì¥í•˜ëŠ” ë°°ì—´
        const stars = [];       // ë°°ê²½ ë³„ë“¤ì„ ì €ì¥í•˜ëŠ” ë°°ì—´

        // ===== ë°°ê²½ ë³„ ìƒì„± í•¨ìˆ˜ =====
        function createStars() {
            // 100ê°œì˜ ë³„ì„ ëœë¤ ìœ„ì¹˜ì— ìƒì„±
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvas.width,    // ëœë¤ X ì¢Œí‘œ
                    y: Math.random() * canvas.height,   // ëœë¤ Y ì¢Œí‘œ
                    size: Math.random() * 2 + 1,        // ëœë¤ í¬ê¸° (1-3)
                    speed: Math.random() * 0.5 + 0.2    // ëœë¤ ë–¨ì–´ì§€ëŠ” ì†ë„
                });
            }
        }

        // ===== í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ =====
        // í‚¤ê°€ ëˆŒë ¸ì„ ë•Œ
        window.addEventListener("keydown", (e) => {
            keys[e.key] = true; // í•´ë‹¹ í‚¤ë¥¼ ëˆŒë¦° ìƒíƒœë¡œ ê¸°ë¡
            
            // ìŠ¤í˜ì´ìŠ¤ë°” ëˆŒë €ì„ ë•Œ íŠ¹ìˆ˜ ìŠ¤í‚¬ ë°œë™
            if (e.key === " ") {
                e.preventDefault(); // í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
                activateSpecialSkill();
            }
        });

        // í‚¤ê°€ ë–¼ì–´ì¡Œì„ ë•Œ
        window.addEventListener("keyup", (e) => {
            keys[e.key] = false; // í•´ë‹¹ í‚¤ë¥¼ ë–¼ì–´ì§„ ìƒíƒœë¡œ ê¸°ë¡
        });

        // ===== í”Œë ˆì´ì–´ ì´ë™ í•¨ìˆ˜ =====
        function movePlayer() {
            let moved = false; // ì´ë™í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í”Œë˜ê·¸
            
            // ìœ„ìª½ í™”ì‚´í‘œ: ìœ„ë¡œ ì´ë™ (í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ ì œí•œ)
            if (keys["ArrowUp"] && player.y > 0) {
                player.y -= player.speed;
                moved = true;
            }
            // ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ: ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
            if (keys["ArrowRight"] && player.x < canvas.width - player.size) {
                player.x += player.speed;
                moved = true;
            }
            // ì•„ë˜ìª½ í™”ì‚´í‘œ: ì•„ë˜ë¡œ ì´ë™
            if (keys["ArrowDown"] && player.y < canvas.height - player.size) {
                player.y += player.speed;
                moved = true;
            }
            // ì™¼ìª½ í™”ì‚´í‘œ: ì™¼ìª½ìœ¼ë¡œ ì´ë™
            if (keys["ArrowLeft"] && player.x > 0) {
                player.x -= player.speed;
                moved = true;
            }

            // í”Œë ˆì´ì–´ê°€ ì´ë™í–ˆë‹¤ë©´ ê¶¤ì  íš¨ê³¼ ì¶”ê°€
            if (moved) {
                player.trail.push({
                    x: player.x + player.size / 2, // í”Œë ˆì´ì–´ ì¤‘ì‹¬ X
                    y: player.y + player.size / 2, // í”Œë ˆì´ì–´ ì¤‘ì‹¬ Y
                    alpha: 1 // íˆ¬ëª…ë„ (1 = ì™„ì „ ë¶ˆíˆ¬ëª…)
                });
                // ê¶¤ì ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
                if (player.trail.length > 10) player.trail.shift();
            }

            // ëª¨ë“  ê¶¤ì  ì ë“¤ì˜ íˆ¬ëª…ë„ë¥¼ ì ì°¨ ê°ì†Œ (í˜ì´ë“œ ì•„ì›ƒ íš¨ê³¼)
            player.trail.forEach(trail => trail.alpha -= 0.1);
        }

        // ===== ì  ìƒì„± í•¨ìˆ˜ =====
        function spawnEnemy() {
            // ì„¸ ê°€ì§€ íƒ€ì…ì˜ ì  ì •ì˜
            const enemyTypes = [
                { color: "#ff4444", size: 20, speed: 1.5, health: 1, score: 10 }, // ë¹¨ê°„ ì : ì¼ë°˜
                { color: "#4444ff", size: 15, speed: 3, health: 1, score: 20 },   // íŒŒë€ ì : ë¹ ë¦„
                { color: "#8844ff", size: 25, speed: 1, health: 3, score: 50 }    // ë³´ë¼ ì : ê°•í•¨
            ];

            // ëœë¤í•˜ê²Œ ì  íƒ€ì… ì„ íƒ
            const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            
            // 8ë°©í–¥ì—ì„œ ì ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” ë°©í–¥ë“¤
            const directions = [
                { x: 0, y: -1 },  // ìœ„
                { x: 1, y: -1 },  // ìš°ìƒ
                { x: 1, y: 0 },   // ìš°
                { x: 1, y: 1 },   // ìš°í•˜
                { x: 0, y: 1 },   // í•˜
                { x: -1, y: 1 },  // ì¢Œí•˜
                { x: -1, y: 0 },  // ì¢Œ
                { x: -1, y: -1 }  // ì¢Œìƒ
            ];

            // ëœë¤ ë°©í–¥ ì„ íƒ
            const randomDirection = directions[Math.floor(Math.random() * directions.length)];

            // ì„ íƒëœ ë°©í–¥ì— ë”°ë¼ í™”ë©´ ê°€ì¥ìë¦¬ì—ì„œ ì  ìƒì„±
            const enemy = {
                // X ì¢Œí‘œ: ë°©í–¥ì´ 0ì´ë©´ í™”ë©´ ë‚´ ëœë¤, ì–‘ìˆ˜ë©´ ì˜¤ë¥¸ìª½ ë, ìŒìˆ˜ë©´ ì™¼ìª½ ë
                x: randomDirection.x === 0 ? Math.random() * canvas.width :
                    randomDirection.x > 0 ? canvas.width : 0,
                // Y ì¢Œí‘œ: ë°©í–¥ì´ 0ì´ë©´ í™”ë©´ ë‚´ ëœë¤, ì–‘ìˆ˜ë©´ ì•„ë˜ìª½ ë, ìŒìˆ˜ë©´ ìœ„ìª½ ë
                y: randomDirection.y === 0 ? Math.random() * canvas.height :
                    randomDirection.y > 0 ? canvas.height : 0,
                ...type,                    // ì  íƒ€ì…ì˜ ëª¨ë“  ì†ì„± ë³µì‚¬
                maxHealth: type.health,     // ìµœëŒ€ ì²´ë ¥ ì €ì¥
                lastHit: 0                  // ë§ˆì§€ë§‰ìœ¼ë¡œ ë§ì€ ì‹œê°„ (í”¼ê²© íš¨ê³¼ìš©)
            };

            enemies.push(enemy); // ì  ë°°ì—´ì— ì¶”ê°€
        }

        // ===== ì  ì´ë™ í•¨ìˆ˜ =====
        function moveEnemies() {
            enemies.forEach((enemy, index) => {
                // í”Œë ˆì´ì–´ì™€ ì  ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // í”Œë ˆì´ì–´ ë°©í–¥ìœ¼ë¡œ ì´ë™ (ì •ê·œí™”ëœ ë°©í–¥ ë²¡í„° * ì†ë„)
                enemy.x += (dx / distance) * enemy.speed;
                enemy.y += (dy / distance) * enemy.speed;

                // í”Œë ˆì´ì–´ì™€ ì¶©ëŒ ì²´í¬
                if (distance < (player.size + enemy.size) / 2) {
                    takeDamage();                                    // í”Œë ˆì´ì–´ ë°ë¯¸ì§€
                    createExplosion(enemy.x, enemy.y, "#ff4444");   // í­ë°œ íš¨ê³¼
                    enemies.splice(index, 1);                       // ì  ì œê±°
                }
            });
        }

        // ===== ì´ì•Œ ìƒì„± í•¨ìˆ˜ =====
        function spawnBullets() {
            // 8ë°©í–¥ ë²¡í„° ì •ì˜
            const directions = [
                { x: 0, y: -1 },  { x: 1, y: -1 },  { x: 1, y: 0 },   { x: 1, y: 1 },
                { x: 0, y: 1 },   { x: -1, y: 1 },  { x: -1, y: 0 },  { x: -1, y: -1 }
            ];

            // íŒŒì›Œì—… ìƒíƒœì— ë”°ë¼ ë°œì‚¬í•  ë°©í–¥ ê²°ì •
            const useDirections = gameState.isPoweredUp ? directions :
                [{ x: 0, y: -1 }, { x: 1, y: 0 }, { x: 0, y: 1 }, { x: -1, y: 0 }]; // 4ë°©í–¥

            // ê° ë°©í–¥ìœ¼ë¡œ ì´ì•Œ ìƒì„±
            useDirections.forEach((direction) => {
                const bullet = {
                    x: player.x + player.size / 2,                    // í”Œë ˆì´ì–´ ì¤‘ì‹¬ì—ì„œ ì‹œì‘
                    y: player.y + player.size / 2,
                    size: gameState.isPoweredUp ? 8 : 5,              // íŒŒì›Œì—… ì‹œ í¬ê¸° ì¦ê°€
                    color: gameState.isPoweredUp ? "#ffff44" : "#00ff88", // íŒŒì›Œì—… ì‹œ ìƒ‰ìƒ ë³€ê²½
                    speed: 8,                                         // ì´ì•Œ ì†ë„
                    dx: direction.x,                                  // X ë°©í–¥
                    dy: direction.y,                                  // Y ë°©í–¥
                    damage: gameState.isPoweredUp ? 2 : 1             // íŒŒì›Œì—… ì‹œ ë°ë¯¸ì§€ ì¦ê°€
                };
                bullets.push(bullet);
            });
        }

        // ===== ì´ì•Œ ì´ë™ í•¨ìˆ˜ =====
        function moveBullets() {
            bullets.forEach((bullet, index) => {
                // ì´ì•Œì„ ì„¤ì •ëœ ë°©í–¥ê³¼ ì†ë„ë¡œ ì´ë™
                bullet.x += bullet.dx * bullet.speed;
                bullet.y += bullet.dy * bullet.speed;

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ì´ì•Œ ì œê±°
                if (bullet.x < 0 || bullet.x > canvas.width ||
                    bullet.y < 0 || bullet.y > canvas.height) {
                    bullets.splice(index, 1);
                }
            });
        }

        // ===== ì´ì•Œê³¼ ì  ì¶©ëŒ ê²€ì‚¬ =====
        function checkBulletCollision() {
            bullets.forEach((bullet, bulletIndex) => {
                enemies.forEach((enemy, enemyIndex) => {
                    // ì´ì•Œê³¼ ì  ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
                    const dx = bullet.x - (enemy.x + enemy.size / 2);
                    const dy = bullet.y - (enemy.y + enemy.size / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // ì¶©ëŒ ê²€ì‚¬ (ê±°ë¦¬ê°€ ë°˜ì§€ë¦„ì˜ í•©ë³´ë‹¤ ì‘ìœ¼ë©´ ì¶©ëŒ)
                    if (distance < (bullet.size + enemy.size) / 2) {
                        enemy.health -= bullet.damage;              // ì  ì²´ë ¥ ê°ì†Œ
                        enemy.lastHit = Date.now();                 // í”¼ê²© ì‹œê°„ ê¸°ë¡
                        bullets.splice(bulletIndex, 1);             // ì´ì•Œ ì œê±°

                        // í”¼ê²© íŒŒí‹°í´ íš¨ê³¼ ìƒì„±
                        createParticles(enemy.x + enemy.size / 2, enemy.y + enemy.size / 2, enemy.color);

                        // ì ì´ ì£½ì—ˆë‹¤ë©´
                        if (enemy.health <= 0) {
                            gameState.score += enemy.score;          // ì ìˆ˜ ì¦ê°€
                            createExplosion(enemy.x, enemy.y, enemy.color); // í­ë°œ íš¨ê³¼
                            enemies.splice(enemyIndex, 1);           // ì  ì œê±°

                            // 10% í™•ë¥ ë¡œ íŒŒì›Œì—… ë“œë¡­
                            if (Math.random() < 0.1) {
                                spawnPowerUp(enemy.x, enemy.y);
                            }
                        }
                    }
                });
            });
        }

        // ===== íŒŒì›Œì—… ìƒì„± í•¨ìˆ˜ =====
        function spawnPowerUp(x, y) {
            // ì„¸ ê°€ì§€ íƒ€ì…ì˜ íŒŒì›Œì—… ì •ì˜
            const types = [
                { 
                    type: "score", 
                    color: "#ffff44", 
                    symbol: "ğŸ’", 
                    effect: () => gameState.score += 100 
                },
                { 
                    type: "power", 
                    color: "#ff8844", 
                    symbol: "âš¡", 
                    effect: () => activatePowerUp() 
                },
                { 
                    type: "health", 
                    color: "#44ff44", 
                    symbol: "ğŸ’–", 
                    effect: () => restoreHealth() 
                }
            ];

            // ëœë¤í•˜ê²Œ íŒŒì›Œì—… íƒ€ì… ì„ íƒí•˜ì—¬ ìƒì„±
            const powerUp = {
                x, y, 
                size: 20,
                ...types[Math.floor(Math.random() * types.length)],
                pulse: 0 // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ìš©
            };

            powerUps.push(powerUp);
        }

        // ===== íŒŒì›Œì—… ì—…ë°ì´íŠ¸ ë° ì¶©ëŒ ê²€ì‚¬ =====
        function updatePowerUps() {
            powerUps.forEach((powerUp, index) => {
                powerUp.pulse += 0.1; // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸

                // í”Œë ˆì´ì–´ì™€ íŒŒì›Œì—… ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
                const dx = powerUp.x - (player.x + player.size / 2);
                const dy = powerUp.y - (player.y + player.size / 2);
                const distance = Math.sqrt(dx * dx + dy * dy);

                // í”Œë ˆì´ì–´ê°€ íŒŒì›Œì—…ì„ íšë“í–ˆëŠ”ì§€ í™•ì¸
                if (distance < (powerUp.size + player.size) / 2) {
                    powerUp.effect();                                // íŒŒì›Œì—… íš¨ê³¼ ì‹¤í–‰
                    createParticles(powerUp.x, powerUp.y, powerUp.color); // íšë“ íš¨ê³¼
                    powerUps.splice(index, 1);                       // íŒŒì›Œì—… ì œê±°
                }
            });
        }

        // ===== íŒŒì›Œì—… í™œì„±í™” =====
        function activatePowerUp() {
            gameState.isPoweredUp = true;
            gameState.powerUpTimer = 300; // 5ì´ˆ (60fps ê¸°ì¤€)
        }

        // ===== ì²´ë ¥ íšŒë³µ =====
        function restoreHealth() {
            if (gameState.health < gameState.maxHealth) {
                gameState.health++;
            }
        }

        // ===== íŠ¹ìˆ˜ ìŠ¤í‚¬ (ì›í˜• ê³µê²©) =====
        function activateSpecialSkill() {
            // 16ë°©í–¥ìœ¼ë¡œ ì´ì•Œ ë°œì‚¬ (ì›í˜•)
            for (let i = 0; i < 16; i++) {
                const angle = (i / 16) * Math.PI * 2; // ê°ë„ ê³„ì‚°
                const bullet = {
                    x: player.x + player.size / 2,
                    y: player.y + player.size / 2,
                    size: 8,
                    color: "#ff44ff",        // íŠ¹ìˆ˜ ìŠ¤í‚¬ ìƒ‰ìƒ
                    speed: 10,
                    dx: Math.cos(angle),     // X ë°©í–¥ (ì½”ì‚¬ì¸)
                    dy: Math.sin(angle),     // Y ë°©í–¥ (ì‚¬ì¸)
                    damage: 3                // ë†’ì€ ë°ë¯¸ì§€
                };
                bullets.push(bullet);
            }
            // ìŠ¤í‚¬ ì‚¬ìš© ì‹œ í­ë°œ íš¨ê³¼
            createExplosion(player.x, player.y, "#ff44ff");
        }

        // ===== ë°ë¯¸ì§€ ë°›ê¸° =====
        function takeDamage() {
            gameState.health--;
            if (gameState.health <= 0) {
                endGame(false); // ê²Œì„ íŒ¨ë°°ë¡œ ì¢…ë£Œ
            }
        }

        // ===== íŒŒí‹°í´ ìƒì„± (ì‘ì€ íš¨ê³¼) =====
        function createParticles(x, y, color) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 4,    // ëœë¤ X ì†ë„
                    vy: (Math.random() - 0.5) * 4,    // ëœë¤ Y ì†ë„
                    life: 30,                         // ìƒì¡´ ì‹œê°„
                    color,
                    size: Math.random() * 3 + 1       // ëœë¤ í¬ê¸°
                });
            }
        }

        // ===== í­ë°œ íš¨ê³¼ ìƒì„± (í° íš¨ê³¼) =====
        function createExplosion(x, y, color) {
            for (let i = 0; i < 15; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 8,    // ë” í° ì†ë„
                    vy: (Math.random() - 0.5) * 8,
                    life: 60,                         // ë” ê¸´ ìƒì¡´ ì‹œê°„
                    color,
                    size: Math.random() * 5 + 2       // ë” í° í¬ê¸°
                });
            }
        }

        // ===== íŒŒí‹°í´ ì—…ë°ì´íŠ¸ =====
        function updateParticles() {
            particles.forEach((particle, index) => {
                particle.x += particle.vx;      // X ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                particle.y += particle.vy;      // Y ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                particle.life--;                // ìƒì¡´ ì‹œê°„ ê°ì†Œ
                particle.size *= 0.98;          // í¬ê¸° ì ì°¨ ê°ì†Œ

                // ìƒì¡´ ì‹œê°„ì´ ëë‚¬ê±°ë‚˜ ë„ˆë¬´ ì‘ì•„ì§€ë©´ ì œê±°
                if (particle.life <= 0 || particle.size < 0.1) {
                    particles.splice(index, 1);
                }
            });
        }

        // ===== ë³„ ë°°ê²½ ì—…ë°ì´íŠ¸ =====
        function updateStars() {
            gameState.backgroundOffset += 0.5; // ë°°ê²½ ìŠ¤í¬ë¡¤ íš¨ê³¼
            stars.forEach(star => {
                star.y += star.speed;           // ë³„ì´ ì•„ë˜ë¡œ ë–¨ì–´ì§
                // í™”ë©´ ì•„ë˜ë¡œ ë‚˜ê°„ ë³„ì€ ìœ„ìª½ì—ì„œ ë‹¤ì‹œ ì‹œì‘
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
        }

        // ===== ë ˆë²¨ ì—…ë°ì´íŠ¸ =====
        function updateLevel() {
            const newLevel = Math.floor(gameState.score / 500) + 1; // 500ì ë§ˆë‹¤ ë ˆë²¨ì—…
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                // ë ˆë²¨ì—… ì‹œ í­ë°œ íš¨ê³¼
                createExplosion(player.x, player.y, "#00ff88");
            }
        }

        // ===== ë Œë”ë§ í•¨ìˆ˜ë“¤ =====
        
        // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
        function drawPlayer() {
            // í”Œë ˆì´ì–´ ê¶¤ì  ê·¸ë¦¬ê¸°
            player.trail.forEach((trail, index) => {
                if (trail.alpha > 0) {
                    ctx.globalAlpha = trail.alpha;  // íˆ¬ëª…ë„ ì ìš©
                    ctx.fillStyle = player.color;
                    ctx.fillRect(trail.x - 2, trail.y - 2, 4, 4);
                }
            });
            ctx.globalAlpha = 1; // íˆ¬ëª…ë„ ì´ˆê¸°í™”

            // í”Œë ˆì´ì–´ ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼
            const gradient = ctx.createRadialGradient(
                player.x + player.size / 2, player.y + player.size / 2, 0,
                player.x + player.size / 2, player.y + player.size / 2, player.size / 2
            );
            gradient.addColorStop(0, player.color);
            gradient.addColorStop(1, "#004422");

            ctx.fillStyle = gradient;
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // íŒŒì›Œì—… ìƒíƒœì¼ ë•Œ ê¸€ë¡œìš° íš¨ê³¼
            if (gameState.isPoweredUp) {
                ctx.shadowColor = "#ffff44";
                ctx.shadowBlur = 20;
                ctx.strokeStyle = "#ffff44";
                ctx.lineWidth = 2;
                ctx.strokeRect(player.x - 2, player.y - 2, player.size + 4, player.size + 4);
                ctx.shadowBlur = 0; // ê·¸ë¦¼ì íš¨ê³¼ ì œê±°
            }
        }

        // ì ë“¤ ê·¸ë¦¬ê¸°
        function drawEnemies() {
            enemies.forEach(enemy => {
                // í”¼ê²© ì‹œ í°ìƒ‰ ê¹œë¹¡ì„ íš¨ê³¼
                const isHit = Date.now() - enemy.lastHit < 100;
                ctx.fillStyle = isHit ? "#ffffff" : enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

                // ì²´ë ¥ì´ 1ë³´ë‹¤ í° ì ì˜ ì²´ë ¥ë°” í‘œì‹œ
                if (enemy.maxHealth > 1) {
                    const barWidth = enemy.size;
                    const barHeight = 4;
                    const healthPercent = enemy.health / enemy.maxHealth;

                    // ì²´ë ¥ë°” ë°°ê²½ (ê²€ì€ìƒ‰)
                    ctx.fillStyle = "#333";
                    ctx.fillRect(enemy.x, enemy.y - 8, barWidth, barHeight);
                    // ì²´ë ¥ë°” (ë¹¨ê°„ìƒ‰)
                    ctx.fillStyle = "#ff4444";
                    ctx.fillRect(enemy.x, enemy.y - 8, barWidth * healthPercent, barHeight);
                }
            });
        }